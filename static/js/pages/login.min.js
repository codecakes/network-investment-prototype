$(document).ready(function() {
  function getFormData($form) {
    var unindexed_array = $form.serializeArray();
    var indexed_array = {};

    $.map(unindexed_array, function(n, i) {
      indexed_array[n["name"]] = n["value"];
    });

    return indexed_array;
  }

  function loginFormAjax(event, data) {
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "",
      data: data,
      success: function(data) {
        data = JSON.parse(data);
        if (data.status == "error") {
          toastr.warning(data.message, "Error");
        } else if (data.status == "ok") {
          window.location = "home";
        }
      }
    });
  }

  function registerFormAjax(event, data) {
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "/signup/",
      data: data,
      success: function(data) {
        data = JSON.parse(data)
        if(data.status == "error") {
          toastr.warning(data.message, "Error");
        } else {
          toastr.success(data.message, "Success");
        }
        // toastr.success(data, "Success");
        // setTimeout(function() {
        //   window.location.reload();
        // }, 500);
      }
    });
  }

  function forgotPasswordAjax(event, data) {
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "",
      data: data,
      success: function(data) {
        data = JSON.parse(data)
        if (data.status == "error") {
          toastr.warning(data.message, "Error");
        } else if (data.status == "ok") {
          toastr.success(data.message, "Success");
        }
      }
    });
  }

  $("#placement_position").change(function() {
    if ($(this).val() == "R") {
      $("#placement_id_right").css("display", "block");
      $("#placement_id_left").css("display", "none");
    } else {
      $("#placement_id_right").css("display", "none");
      $("#placement_id_left").css("display", "block");
    }
  });

  $("#referal").on("focusout", function() {
    if ($(this).val()) {
      var data = {
        referal: $(this).val()
      };
      $.ajax({
        type: "GET",
        url: "/check-referal",
        data: data,
        dataType: "json",
        success: function(data) {
          if (data.status == "error") {
            toastr.warning(data.message, "Error")
            $("#referal").val("")
            $("#sponser_id").val("")
            $("#placement_id_left").val("")
            $("#placement_id_right").val("")
            $("#referal").focus()
          } else {
            $("#sponser_id").val(data.data.sponser_id)
            $("#placement_id_left").val(data.data.placement_user_left_id)
            $("#placement_id_right").val(data.data.placement_user_right_id)
          }
        }
      });
    }
  });

  $("#placement_id_left").on("focusout", function() {

  })

  $("#placement_id_right").on("focusout", function() {

  })

  $("input,select,textarea")
    .not("[type=submit]")
    .jqBootstrapValidation({
      submitSuccess: function($form, event) {
        var formId = $form.attr("id");
        var data = getFormData($form);
        if (formId == "registerForm") {
          registerFormAjax(event, data);
        } else if (formId == "forgotPasswordForm") {
          forgotPasswordAjax(event, data)
        } else {
          loginFormAjax(event, data);
        }
      }
    });
});
